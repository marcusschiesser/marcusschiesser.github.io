<!DOCTYPE html>
<html lang="en-US" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="http://www.marcusschiesser.de/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://www.marcusschiesser.de/wp-content/themes/twentyfifteen/js/html5.js"></script>
	<![endif]-->
	<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<title>Java, Oracle, JBoss - Enterprise Software Development | Marcus Schiesser - Part 3</title>

<!-- All in One SEO Pack 2.2.7.1 by Michael Torbert of Semper Fi Web Design[502,593] -->
<link rel='prev' href='http://www.marcusschiesser.de/page/2/' />
<link rel='next' href='http://www.marcusschiesser.de/page/4/' />

<link rel="canonical" href="http://www.marcusschiesser.de/page/3/" />
<!-- /all in one seo pack -->
<link rel="alternate" type="application/rss+xml" title="Marcus Schiesser &raquo; Feed" href="http://www.marcusschiesser.de/feed/" />
<link rel="alternate" type="application/rss+xml" title="Marcus Schiesser &raquo; Comments Feed" href="http://www.marcusschiesser.de/comments/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.marcusschiesser.de\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.3.1"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='http://www.marcusschiesser.de/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='http://www.marcusschiesser.de/wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css?ver=2.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='http://www.marcusschiesser.de/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentyfifteen-fonts-css'  href='https://fonts.googleapis.com/css?family=Noto+Sans%3A400italic%2C700italic%2C400%2C700%7CNoto+Serif%3A400italic%2C700italic%2C400%2C700%7CInconsolata%3A400%2C700&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='http://www.marcusschiesser.de/wp-content/themes/twentyfifteen/genericons/genericons.css?ver=3.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentyfifteen-style-css'  href='http://www.marcusschiesser.de/wp-content/themes/twentyfifteen/style.css?ver=4.3.1' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentyfifteen-ie-css'  href='http://www.marcusschiesser.de/wp-content/themes/twentyfifteen/css/ie.css?ver=20141010' type='text/css' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentyfifteen-ie7-css'  href='http://www.marcusschiesser.de/wp-content/themes/twentyfifteen/css/ie7.css?ver=20141010' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://www.marcusschiesser.de/wp-includes/js/jquery/jquery.js?ver=1.11.3'></script>
<script type='text/javascript' src='http://www.marcusschiesser.de/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.7.1","is_admin":"0","ajaxurl":"http:\/\/www.marcusschiesser.de\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.marcusschiesser.de/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=2.7.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.marcusschiesser.de/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.marcusschiesser.de/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.3.1" />
		<style>
		.gist table {
			margin-bottom: 0 !important;
		}
		.gist .line-numbers
		{
			width: 4em !important;
		}
		.gist .line,
		.gist .line-number
		{
			font-size: 12px !important;
			height: 18px !important;
			line-height: 18px !important;
		}
		.gist .line
		{
			white-space: pre !important;
			width: auto !important;
			word-wrap: normal !important;
		}
		.gist .line span
		{
			word-wrap: normal !important;
		}
		</style>
		</head>

<body class="home blog paged paged-3">
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<div id="sidebar" class="sidebar">
		<header id="masthead" class="site-header" role="banner">
			<div class="site-branding">
										<h1 class="site-title"><a href="http://www.marcusschiesser.de/" rel="home">Marcus Schiesser</a></h1>
											<p class="site-description">Enterprise Software Development with JavaScript and Java</p>
									<button class="secondary-toggle">Menu and widgets</button>
			</div><!-- .site-branding -->
		</header><!-- .site-header -->

			<div id="secondary" class="secondary">

		
		
					<div id="widget-area" class="widget-area" role="complementary">
				<aside id="tag_cloud-2" class="widget widget_tag_cloud"><h2 class="widget-title">Topics</h2><div class="tagcloud"><a href='http://www.marcusschiesser.de/tag/actionscript/' class='tag-link-56' title='2 topics' style='font-size: 8pt;'>actionscript</a>
<a href='http://www.marcusschiesser.de/tag/axis2/' class='tag-link-97' title='2 topics' style='font-size: 8pt;'>axis2</a>
<a href='http://www.marcusschiesser.de/tag/backend/' class='tag-link-198' title='2 topics' style='font-size: 8pt;'>backend</a>
<a href='http://www.marcusschiesser.de/tag/bewerbung/' class='tag-link-38' title='2 topics' style='font-size: 8pt;'>bewerbung</a>
<a href='http://www.marcusschiesser.de/tag/button/' class='tag-link-155' title='2 topics' style='font-size: 8pt;'>button</a>
<a href='http://www.marcusschiesser.de/tag/combo/' class='tag-link-126' title='3 topics' style='font-size: 10.333333333333pt;'>combo</a>
<a href='http://www.marcusschiesser.de/tag/component/' class='tag-link-248' title='3 topics' style='font-size: 10.333333333333pt;'>Component</a>
<a href='http://www.marcusschiesser.de/tag/country/' class='tag-link-129' title='2 topics' style='font-size: 8pt;'>country</a>
<a href='http://www.marcusschiesser.de/tag/effekt/' class='tag-link-15' title='2 topics' style='font-size: 8pt;'>Effekt</a>
<a href='http://www.marcusschiesser.de/tag/error/' class='tag-link-107' title='2 topics' style='font-size: 8pt;'>error</a>
<a href='http://www.marcusschiesser.de/tag/ext/' class='tag-link-115' title='7 topics' style='font-size: 16.166666666667pt;'>ext</a>
<a href='http://www.marcusschiesser.de/tag/extjs/' class='tag-link-249' title='15 topics' style='font-size: 22pt;'>ExtJS</a>
<a href='http://www.marcusschiesser.de/tag/facebook/' class='tag-link-23' title='2 topics' style='font-size: 8pt;'>facebook</a>
<a href='http://www.marcusschiesser.de/tag/feed/' class='tag-link-25' title='2 topics' style='font-size: 8pt;'>feed</a>
<a href='http://www.marcusschiesser.de/tag/field/' class='tag-link-137' title='3 topics' style='font-size: 10.333333333333pt;'>field</a>
<a href='http://www.marcusschiesser.de/tag/flash/' class='tag-link-71' title='2 topics' style='font-size: 8pt;'>flash</a>
<a href='http://www.marcusschiesser.de/tag/flex/' class='tag-link-14' title='15 topics' style='font-size: 22pt;'>Flex</a>
<a href='http://www.marcusschiesser.de/tag/form/' class='tag-link-128' title='2 topics' style='font-size: 8pt;'>form</a>
<a href='http://www.marcusschiesser.de/tag/spas/' class='tag-link-244' title='4 topics' style='font-size: 12.277777777778pt;'>Fun</a>
<a href='http://www.marcusschiesser.de/tag/google/' class='tag-link-69' title='2 topics' style='font-size: 8pt;'>google</a>
<a href='http://www.marcusschiesser.de/tag/grid/' class='tag-link-113' title='3 topics' style='font-size: 10.333333333333pt;'>grid</a>
<a href='http://www.marcusschiesser.de/tag/handler/' class='tag-link-58' title='2 topics' style='font-size: 8pt;'>handler</a>
<a href='http://www.marcusschiesser.de/tag/html/' class='tag-link-94' title='2 topics' style='font-size: 8pt;'>html</a>
<a href='http://www.marcusschiesser.de/tag/ideen/' class='tag-link-19' title='3 topics' style='font-size: 10.333333333333pt;'>Ideen</a>
<a href='http://www.marcusschiesser.de/tag/info/' class='tag-link-78' title='2 topics' style='font-size: 8pt;'>info</a>
<a href='http://www.marcusschiesser.de/tag/java/' class='tag-link-250' title='6 topics' style='font-size: 15.194444444444pt;'>Java</a>
<a href='http://www.marcusschiesser.de/tag/javascript/' class='tag-link-101' title='4 topics' style='font-size: 12.277777777778pt;'>javascript</a>
<a href='http://www.marcusschiesser.de/tag/jboss-2/' class='tag-link-186' title='2 topics' style='font-size: 8pt;'>jboss</a>
<a href='http://www.marcusschiesser.de/tag/jersey/' class='tag-link-175' title='3 topics' style='font-size: 10.333333333333pt;'>jersey</a>
<a href='http://www.marcusschiesser.de/tag/job/' class='tag-link-39' title='2 topics' style='font-size: 8pt;'>job</a>
<a href='http://www.marcusschiesser.de/tag/json/' class='tag-link-72' title='3 topics' style='font-size: 10.333333333333pt;'>json</a>
<a href='http://www.marcusschiesser.de/tag/map/' class='tag-link-70' title='3 topics' style='font-size: 10.333333333333pt;'>map</a>
<a href='http://www.marcusschiesser.de/tag/mashup/' class='tag-link-11' title='5 topics' style='font-size: 13.833333333333pt;'>Mashup</a>
<a href='http://www.marcusschiesser.de/tag/message/' class='tag-link-103' title='2 topics' style='font-size: 8pt;'>message</a>
<a href='http://www.marcusschiesser.de/tag/sonstiges/' class='tag-link-243' title='3 topics' style='font-size: 10.333333333333pt;'>Other</a>
<a href='http://www.marcusschiesser.de/tag/pictures/' class='tag-link-66' title='2 topics' style='font-size: 8pt;'>pictures</a>
<a href='http://www.marcusschiesser.de/tag/pojo/' class='tag-link-99' title='2 topics' style='font-size: 8pt;'>pojo</a>
<a href='http://www.marcusschiesser.de/tag/presse/' class='tag-link-8' title='2 topics' style='font-size: 8pt;'>Presse</a>
<a href='http://www.marcusschiesser.de/tag/programmierung/' class='tag-link-4' title='3 topics' style='font-size: 10.333333333333pt;'>Programmierung</a>
<a href='http://www.marcusschiesser.de/tag/proxy/' class='tag-link-118' title='2 topics' style='font-size: 8pt;'>proxy</a>
<a href='http://www.marcusschiesser.de/tag/rails/' class='tag-link-247' title='2 topics' style='font-size: 8pt;'>Rails</a>
<a href='http://www.marcusschiesser.de/tag/rest/' class='tag-link-180' title='2 topics' style='font-size: 8pt;'>rest</a>
<a href='http://www.marcusschiesser.de/tag/selector/' class='tag-link-130' title='4 topics' style='font-size: 12.277777777778pt;'>selector</a>
<a href='http://www.marcusschiesser.de/tag/web-20/' class='tag-link-6' title='4 topics' style='font-size: 12.277777777778pt;'>Web 2.0</a>
<a href='http://www.marcusschiesser.de/tag/wordpress/' class='tag-link-246' title='2 topics' style='font-size: 8pt;'>Wordpress</a></div>
</aside><aside id="linkcat-2" class="widget widget_links"><h2 class="widget-title">Blogroll</h2>
	<ul class='xoxo blogroll'>
<li><a href="http://pdf.venedo.com/" rel="friend met" title="A blog about PDFs without barriers">Accessible PDFs</a></li>
<li><a href="http://www.best-practice-business.de/blog/" title="Business Ideen und Lösungen">best-practice-business</a></li>
<li><a href="http://blog.digitalbackcountry.com/" title="Blog über RIAs von Ryan Stewart, Technological Evangelist bei Adobe">Digital Backcountry</a></li>
<li><a href="http://juriswritings.blogspot.de/">Juri&#039;s Writings &#8211; Software, technology and science.</a></li>
<li><a href="http://radar.oreilly.com/">O&#8217;Reilly Radar</a></li>
<li><a href="http://blog.stefanbotzenhart.com/" rel="contact met co-worker">Stefan Botzenhart</a></li>
<li><a href="http://www.turngeek.press" title="Turngeek press &#8211; Online Java books" target="_blank">Turngeek press</a></li>

	</ul>
</aside>
			</div><!-- .widget-area -->
		
	</div><!-- .secondary -->

	</div><!-- .sidebar -->

	<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
			
			
<article id="post-485" class="post-485 post type-post status-publish format-standard hentry category-java tag-facebook tag-feed tag-graph-api tag-gwt tag-oauth tag-oauth2 tag-send tag-wall">
	
	<header class="entry-header">
		<h2 class="entry-title"><a href="http://www.marcusschiesser.de/2013/01/03/using-the-facebook-graph-api-from-your-gwt-application/" rel="bookmark">Using the Facebook Graph API from your GWT application</a></h2>	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>It might happen that you have a GWT application and you want to use the <a href="https://developers.facebook.com/docs/reference/api/">Graph API</a> from Facebook.<br />
As the Graph API requires an authentication with <a href="http://oauth.net/2/">OAuth2</a> this task can be easily accomplished using the <a href="http://code.google.com/p/gwt-oauth2/">GWT-OAuth2 library</a>.<br />
To simplify things even more I build the following utility class for you:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-57a019874cdde171625959" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
public class FacebookUtil {
    private String token = null;

    private static FacebookUtil instance = new FacebookUtil();

    private static final String FACEBOOK_AUTH_URL = "https://www.facebook.com/dialog/oauth";

    private static final String FACEBOOK_CLIENT_ID = "MY_CLIENT_ID"; 

    private FacebookUtil() {
    }

    public static FacebookUtil getInstance() {
	return instance;
    }

    public void resetToken() {
	token = null;
    }

    private void doAuth(Callback&lt;String, Throwable&gt; callback) {
	final AuthRequest req = new AuthRequest(FACEBOOK_AUTH_URL,
		FACEBOOK_CLIENT_ID).withScopes("email", "user_birthday",
		"user_hometown", "user_location", "publish_stream")
	// Facebook expects a comma-delimited list of scopes
		.withScopeDelimiter(",");
	Auth.get().clearAllTokens();
	Auth.get().login(req, callback);
    }

    public void doGraph(final String id,
	    final Callback&lt;JSONObject, Throwable&gt; callback) {
	doGraph(id, RequestBuilder.GET, null, callback);
    }

    public void doGraph(final String id, final Method method,
	    final String params, final Callback&lt;JSONObject, Throwable&gt; callback) {
	if (token == null) {
	    doAuth(new Callback&lt;String, Throwable&gt;() {
		public void onSuccess(String token) {
		    FacebookUtil.this.token = token;
		    doGraphNoAuth(id, method, params, callback);
		}

		public void onFailure(Throwable reason) {
		    callback.onFailure(reason);
		}
	    });
	} else {
	    doGraphNoAuth(id, method, params, callback);
	}
    }

    private void doGraphNoAuth(String id, Method method, String params,
	    final Callback&lt;JSONObject, Throwable&gt; callback) {
	final String requestData = "access_token=" + token
		+ (params != null ? "&amp;" + params : "");
	RequestBuilder builder;
	if (method == RequestBuilder.POST) {
	    builder = new RequestBuilder(method, "https://graph.facebook.com/"
		    + id);
	    builder.setHeader("Content-Type",
		    "application/x-www-form-urlencoded");
	} else if (method == RequestBuilder.GET) {
	    builder = new RequestBuilder(method, "https://graph.facebook.com/"
		    + id + "?" + requestData);
	} else {
	    callback.onFailure(new IOException(
		    "doGraph only supports GET and POST requests"));
	    return;
	}
	try {
	    builder.sendRequest(requestData, new RequestCallback() {
		public void onError(Request request, Throwable exception) {
		    callback.onFailure(exception);
		}

		public void onResponseReceived(Request request,
			Response response) {
		    if (Response.SC_OK == response.getStatusCode()) {
			callback.onSuccess(JSONParser.parseStrict(
				response.getText()).isObject());
		    } else if (Response.SC_BAD_REQUEST == response
			    .getStatusCode()) {
			callback.onFailure(new IOException("Error: "
				+ response.getText()));
		    } else {
			callback.onFailure(new IOException(
				"Couldn't retrieve JSON ("
					+ response.getStatusText() + ")"));
		    }
		}

	    });
	} catch (RequestException e) {
	    callback.onFailure(e);
	}
    }

}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-57a019874cdde171625959-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-2">2</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-4">4</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-6">6</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-8">8</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-10">10</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-12">12</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-14">14</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-16">16</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-18">18</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-20">20</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-22">22</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-24">24</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-26">26</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-28">28</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-30">30</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-32">32</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-34">34</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-36">36</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-38">38</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-40">40</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-42">42</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-44">44</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-46">46</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-48">48</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-50">50</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-52">52</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-54">54</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-56">56</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-58">58</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-60">60</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-62">62</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-64">64</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-66">66</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-68">68</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-70">70</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-72">72</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-74">74</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-76">76</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-78">78</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-80">80</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-82">82</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-84">84</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-86">86</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-88">88</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-90">90</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-92">92</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-94">94</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-96">96</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-98">98</div><div class="crayon-num" data-line="crayon-57a019874cdde171625959-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdde171625959-100">100</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-57a019874cdde171625959-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">FacebookUtil</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">FacebookUtil </span><span class="crayon-v">instance</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">FacebookUtil</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">FACEBOOK_AUTH_URL</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"https://www.facebook.com/dialog/oauth"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">FACEBOOK_CLIENT_ID</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"MY_CLIENT_ID"</span><span class="crayon-sy">;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">FacebookUtil</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-12">&nbsp;</div><div class="crayon-line" id="crayon-57a019874cdde171625959-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-e">FacebookUtil </span><span class="crayon-e">getInstance</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-14"><span class="crayon-h">	</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">instance</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-16">&nbsp;</div><div class="crayon-line" id="crayon-57a019874cdde171625959-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">resetToken</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-18"><span class="crayon-h">	</span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-20">&nbsp;</div><div class="crayon-line" id="crayon-57a019874cdde171625959-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">doAuth</span><span class="crayon-sy">(</span><span class="crayon-v">Callback</span><span class="crayon-o">&lt;</span><span class="crayon-t">String</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Throwable</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-22"><span class="crayon-h">	</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">AuthRequest </span><span class="crayon-v">req</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">AuthRequest</span><span class="crayon-sy">(</span><span class="crayon-v">FACEBOOK_AUTH_URL</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-23"><span class="crayon-h">		</span><span class="crayon-v">FACEBOOK_CLIENT_ID</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">withScopes</span><span class="crayon-sy">(</span><span class="crayon-s">"email"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"user_birthday"</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-24"><span class="crayon-h">		</span><span class="crayon-s">"user_hometown"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"user_location"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"publish_stream"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-25"><span class="crayon-h">	</span><span class="crayon-c">// Facebook expects a comma-delimited list of scopes</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-26"><span class="crayon-h">		</span><span class="crayon-sy">.</span><span class="crayon-e">withScopeDelimiter</span><span class="crayon-sy">(</span><span class="crayon-s">","</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-27"><span class="crayon-h">	</span><span class="crayon-v">Auth</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">clearAllTokens</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-28"><span class="crayon-h">	</span><span class="crayon-v">Auth</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">login</span><span class="crayon-sy">(</span><span class="crayon-v">req</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-30">&nbsp;</div><div class="crayon-line" id="crayon-57a019874cdde171625959-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">doGraph</span><span class="crayon-sy">(</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-32"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-v">Callback</span><span class="crayon-o">&lt;</span><span class="crayon-v">JSONObject</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Throwable</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-33"><span class="crayon-h">	</span><span class="crayon-e">doGraph</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">RequestBuilder</span><span class="crayon-sy">.</span><span class="crayon-v">GET</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-35">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">doGraph</span><span class="crayon-sy">(</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Method </span><span class="crayon-v">method</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-37"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-v">Callback</span><span class="crayon-o">&lt;</span><span class="crayon-v">JSONObject</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Throwable</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-38"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-39"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">doAuth</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Callback</span><span class="crayon-o">&lt;</span><span class="crayon-t">String</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Throwable</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-40"><span class="crayon-h">		</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onSuccess</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-41"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">FacebookUtil</span><span class="crayon-sy">.</span><span class="crayon-v">this</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">token</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-42"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">doGraphNoAuth</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-43"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-44">&nbsp;</div><div class="crayon-line" id="crayon-57a019874cdde171625959-45"><span class="crayon-h">		</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onFailure</span><span class="crayon-sy">(</span><span class="crayon-e">Throwable </span><span class="crayon-v">reason</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-46"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callback</span><span class="crayon-sy">.</span><span class="crayon-e">onFailure</span><span class="crayon-sy">(</span><span class="crayon-v">reason</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-47"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-48"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-49"><span class="crayon-h">	</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-50"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">doGraphNoAuth</span><span class="crayon-sy">(</span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">method</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-51"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-53">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-54"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">doGraphNoAuth</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Method </span><span class="crayon-v">method</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-55"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-v">Callback</span><span class="crayon-o">&lt;</span><span class="crayon-v">JSONObject</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Throwable</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">callback</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-56"><span class="crayon-h">	</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">requestData</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"access_token="</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">token</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-57"><span class="crayon-h">		</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">params</span><span class="crayon-h"> </span><span class="crayon-o">!=</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-h"> </span><span class="crayon-sy">?</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-h"> </span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">""</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-58"><span class="crayon-h">	</span><span class="crayon-e">RequestBuilder </span><span class="crayon-v">builder</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-59"><span class="crayon-h">	</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">method</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">RequestBuilder</span><span class="crayon-sy">.</span><span class="crayon-v">POST</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-60"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">builder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">RequestBuilder</span><span class="crayon-sy">(</span><span class="crayon-v">method</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"https://graph.facebook.com/"</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-61"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-62"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">builder</span><span class="crayon-sy">.</span><span class="crayon-e">setHeader</span><span class="crayon-sy">(</span><span class="crayon-s">"Content-Type"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-63"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"application/x-www-form-urlencoded"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-64"><span class="crayon-h">	</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">method</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">RequestBuilder</span><span class="crayon-sy">.</span><span class="crayon-v">GET</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-65"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">builder</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">RequestBuilder</span><span class="crayon-sy">(</span><span class="crayon-v">method</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"https://graph.facebook.com/"</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-66"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"?"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">requestData</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-67"><span class="crayon-h">	</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-68"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callback</span><span class="crayon-sy">.</span><span class="crayon-e">onFailure</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">IOException</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-69"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"doGraph only supports GET and POST requests"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-70"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-71"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-72"><span class="crayon-h">	</span><span class="crayon-st">try</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-73"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">builder</span><span class="crayon-sy">.</span><span class="crayon-e">sendRequest</span><span class="crayon-sy">(</span><span class="crayon-v">requestData</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">RequestCallback</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-74"><span class="crayon-h">		</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onError</span><span class="crayon-sy">(</span><span class="crayon-e">Request </span><span class="crayon-v">request</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">Throwable </span><span class="crayon-v">exception</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-75"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callback</span><span class="crayon-sy">.</span><span class="crayon-e">onFailure</span><span class="crayon-sy">(</span><span class="crayon-v">exception</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-76"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-77">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-78"><span class="crayon-h">		</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onResponseReceived</span><span class="crayon-sy">(</span><span class="crayon-e">Request </span><span class="crayon-v">request</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-79"><span class="crayon-h">			</span><span class="crayon-e">Response </span><span class="crayon-v">response</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-80"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Response</span><span class="crayon-sy">.</span><span class="crayon-v">SC_OK</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">getStatusCode</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-81"><span class="crayon-h">			</span><span class="crayon-v">callback</span><span class="crayon-sy">.</span><span class="crayon-e">onSuccess</span><span class="crayon-sy">(</span><span class="crayon-v">JSONParser</span><span class="crayon-sy">.</span><span class="crayon-e">parseStrict</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-82"><span class="crayon-h">				</span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">getText</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">isObject</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-83"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">Response</span><span class="crayon-sy">.</span><span class="crayon-v">SC_BAD_REQUEST</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-i">response</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-84"><span class="crayon-h">			&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">getStatusCode</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-85"><span class="crayon-h">			</span><span class="crayon-v">callback</span><span class="crayon-sy">.</span><span class="crayon-e">onFailure</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">IOException</span><span class="crayon-sy">(</span><span class="crayon-s">"Error: "</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-86"><span class="crayon-h">				</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">getText</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-87"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">else</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-88"><span class="crayon-h">			</span><span class="crayon-v">callback</span><span class="crayon-sy">.</span><span class="crayon-e">onFailure</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">IOException</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-89"><span class="crayon-h">				</span><span class="crayon-s">"Couldn't retrieve JSON ("</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-90"><span class="crayon-h">					</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">getStatusText</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">")"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-91"><span class="crayon-h">		&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-92"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-93">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-94"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-95"><span class="crayon-h">	</span><span class="crayon-sy">}</span><span class="crayon-h"> </span><span class="crayon-st">catch</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-i">RequestException</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-96"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">callback</span><span class="crayon-sy">.</span><span class="crayon-e">onFailure</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-97"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874cdde171625959-99">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdde171625959-100"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0842 seconds] -->
<p></p>
<p>After setting the <a href="http://rieglerova.net/how-to-get-a-facebook-app-id/">unique ID of your facebook app</a> in the constant <code>FACEBOOK_CLIENT_ID</code>, you can easily use the Graph API by calling the <code>doGraph</code> method.<br />
Here is an example that posts a message on the feed of the app user by sending some data to the <code>me/feed</code> path:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-57a019874cdec374534400" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
FacebookUtil.getInstance().doGraph(
	"/me/feed/",
	RequestBuilder.POST,
	"message="
		+ URL.encodeQueryString(message)
		+ "&amp;link=" + URL.encodeQueryString(url),
	new Callback&lt;JSONObject, Throwable&gt;() {
	    public void onFailure(Throwable reason) {
	    }

	    public void onSuccess(JSONObject result) {
	    }
	});</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-57a019874cdec374534400-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdec374534400-2">2</div><div class="crayon-num" data-line="crayon-57a019874cdec374534400-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdec374534400-4">4</div><div class="crayon-num" data-line="crayon-57a019874cdec374534400-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdec374534400-6">6</div><div class="crayon-num" data-line="crayon-57a019874cdec374534400-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdec374534400-8">8</div><div class="crayon-num" data-line="crayon-57a019874cdec374534400-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdec374534400-10">10</div><div class="crayon-num" data-line="crayon-57a019874cdec374534400-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874cdec374534400-12">12</div><div class="crayon-num" data-line="crayon-57a019874cdec374534400-13">13</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-57a019874cdec374534400-1"><span class="crayon-v">FacebookUtil</span><span class="crayon-sy">.</span><span class="crayon-e">getInstance</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">doGraph</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdec374534400-2"><span class="crayon-h">	</span><span class="crayon-s">"/me/feed/"</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-57a019874cdec374534400-3"><span class="crayon-h">	</span><span class="crayon-v">RequestBuilder</span><span class="crayon-sy">.</span><span class="crayon-v">POST</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdec374534400-4"><span class="crayon-h">	</span><span class="crayon-s">"message="</span></div><div class="crayon-line" id="crayon-57a019874cdec374534400-5"><span class="crayon-h">		</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">URL</span><span class="crayon-sy">.</span><span class="crayon-e">encodeQueryString</span><span class="crayon-sy">(</span><span class="crayon-v">message</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdec374534400-6"><span class="crayon-h">		</span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">"&amp;link="</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">URL</span><span class="crayon-sy">.</span><span class="crayon-e">encodeQueryString</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-57a019874cdec374534400-7"><span class="crayon-h">	</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">Callback</span><span class="crayon-o">&lt;</span><span class="crayon-v">JSONObject</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Throwable</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdec374534400-8"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onFailure</span><span class="crayon-sy">(</span><span class="crayon-e">Throwable </span><span class="crayon-v">reason</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874cdec374534400-9"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdec374534400-10">&nbsp;</div><div class="crayon-line" id="crayon-57a019874cdec374534400-11"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">onSuccess</span><span class="crayon-sy">(</span><span class="crayon-e">JSONObject </span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874cdec374534400-12"><span class="crayon-h">	&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874cdec374534400-13"><span class="crayon-h">	</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0017 seconds] -->
<p></p>
<p>As you notice the variables <code>message</code> and <code>url</code> need to be defined with values of your choice before. Now have fun trying other methods of the Graph API.<br />
If you need further permissions, you have to add them as parameters to the call of <code>withScopes</code> inside of the <code>doAuth</code> method.</p>
	</div><!-- .entry-content -->

	
	<footer class="entry-footer">
		<span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="http://www.marcusschiesser.de/2013/01/03/using-the-facebook-graph-api-from-your-gwt-application/" rel="bookmark"><time class="entry-date published" datetime="2013-01-03T14:49:30+00:00">January 3, 2013</time><time class="updated" datetime="2013-01-03T14:51:16+00:00">January 3, 2013</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="http://www.marcusschiesser.de/category/technologie/java/" rel="category tag">Java</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="http://www.marcusschiesser.de/tag/facebook/" rel="tag">facebook</a>, <a href="http://www.marcusschiesser.de/tag/feed/" rel="tag">feed</a>, <a href="http://www.marcusschiesser.de/tag/graph-api/" rel="tag">graph api</a>, <a href="http://www.marcusschiesser.de/tag/gwt/" rel="tag">gwt</a>, <a href="http://www.marcusschiesser.de/tag/oauth/" rel="tag">oauth</a>, <a href="http://www.marcusschiesser.de/tag/oauth2/" rel="tag">oauth2</a>, <a href="http://www.marcusschiesser.de/tag/send/" rel="tag">send</a>, <a href="http://www.marcusschiesser.de/tag/wall/" rel="tag">wall</a></span><span class="comments-link"><a href="http://www.marcusschiesser.de/2013/01/03/using-the-facebook-graph-api-from-your-gwt-application/#respond"><span class="dsq-postid" data-dsqidentifier="485 http://www.marcusschiesser.de/?p=485">Leave a comment<span class="screen-reader-text"> on Using the Facebook Graph API from your GWT application</span></span></a></span>			</footer><!-- .entry-footer -->

</article><!-- #post-## -->

<article id="post-436" class="post-436 post type-post status-publish format-standard hentry category-android tag-android-2 tag-app-engine tag-backend tag-jersey">
	
	<header class="entry-header">
		<h2 class="entry-title"><a href="http://www.marcusschiesser.de/2011/12/02/using-google-app-engine-as-backend-for-android/" rel="bookmark">Using Google App Engine as Backend for Android</a></h2>	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>If you&#8217;re looking for a way to create a backend for your Android application, Google App Engine looks like the perfect choice: You can use Java as you can do for Android and you don&#8217;t need to think too much about hosting, as it is all stored in the cloud. </p>
<p>Another benefit is that you can reuse your <a href="http://java.sun.com/blueprints/patterns/TransferObject.html">transfer objects</a> on the client and on server side. But as it is often there are some problems doing this in practice. So you don&#8217;t have the same ones I had, I am glad to share my experiences with you.</p>
<p>So first question is what libraries are to use for the client/server communication. At start I tried <a href="http://www.restlet.org">Restlet 2.0</a>. Looked like a great choice as there are special editions for App Engine and for Android available. In practice it is not very useful as the libraries are to big for Android and I also very much disliked that fully serialized java objects are transfered.</p>
<p>Best approach I found so far is to use <a href="http://jersey.java.net/">Jersey 1.6</a>: It is easy to use and implements the JAX-RS (JSR 311) standard. To set it up on the App Engine, please consult these blog posts from me: <a href="http://www.marcusschiesser.de/2011/12/using-real-pojos-without-jaxb-annotations-as-transfer-objects-with-jax-rs/" title="Using real POJOs (without JAXB Annotations) as transfer objects with JAX-RS">Using real POJOs (without JAXB Annotations) as transfer objects with JAX-RS</a> and <a href="http://www.marcusschiesser.de/2011/12/storing-large-images-restful-in-the-cloud-using-google-app-engine/" title="Storing large images RESTful in the cloud using Google App Engine">Storing large images RESTful in the cloud using Google App Engine</a>.</p>
<p>Ok, so far about the server side. To keep things small and simple on the Android side, I mainly created the following wrapper class for the <code>HttpClient</code> to handle the HTTP requests:</p>
<div class="oembed-gist"><script src="https://gist.github.com/marcusschiesser/5474307.js"></script><noscript>View the code on <a href="https://gist.github.com/marcusschiesser/5474307">Gist</a>.</noscript></div>
<p>This implementation is far from perfect, especially exception handling and passing parameters need to be improved, but it works so far <img src="http://www.marcusschiesser.de/wp-includes/images/smilies/simple-smile.png" alt=":)" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<p>Using this class it is easy to store a file using the <code>FileServerResource</code> from my former blog post. Just call:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-57a019874d596388303547" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
File imageFile = new File(new URI(myimgage.getImageURL()));
String url = HttpUtils.getInstance().doPutFile("file/store", imageFile);</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-57a019874d596388303547-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d596388303547-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-57a019874d596388303547-1"><span class="crayon-e">File </span><span class="crayon-v">imageFile</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">File</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">URI</span><span class="crayon-sy">(</span><span class="crayon-v">myimgage</span><span class="crayon-sy">.</span><span class="crayon-e">getImageURL</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d596388303547-2"><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">url</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">HttpUtils</span><span class="crayon-sy">.</span><span class="crayon-e">getInstance</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">doPutFile</span><span class="crayon-sy">(</span><span class="crayon-s">"file/store"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">imageFile</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p></p>
<p>Also it is easy to store a transfer object using the <code>doPut</code> method. Note that is is using the <code>ObjectMapper</code> class from <a href="http://jackson.codehaus.org/">Jackson</a>, the same JSON processor that is also used by Jersey.<br />
Jackson is therefore the only additional library that you need on the Android side which keeps the executable small. If you use the same version of Jackson on the client side as on the server side you&#8217;re also ensured that the (un-)marshalling process of your transfer objects works flawlessly on both sides.</p>
<p>Hope you liked this approach &#8211; feel free to discuss here further ideas.</p>
	</div><!-- .entry-content -->

	
	<footer class="entry-footer">
		<span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="http://www.marcusschiesser.de/2011/12/02/using-google-app-engine-as-backend-for-android/" rel="bookmark"><time class="entry-date published" datetime="2011-12-02T18:40:57+00:00">December 2, 2011</time><time class="updated" datetime="2013-04-27T20:23:44+00:00">April 27, 2013</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="http://www.marcusschiesser.de/category/android/" rel="category tag">Android</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="http://www.marcusschiesser.de/tag/android-2/" rel="tag">android</a>, <a href="http://www.marcusschiesser.de/tag/app-engine/" rel="tag">app engine</a>, <a href="http://www.marcusschiesser.de/tag/backend/" rel="tag">backend</a>, <a href="http://www.marcusschiesser.de/tag/jersey/" rel="tag">jersey</a></span><span class="comments-link"><a href="http://www.marcusschiesser.de/2011/12/02/using-google-app-engine-as-backend-for-android/#respond"><span class="dsq-postid" data-dsqidentifier="436 http://www.marcusschiesser.de/?p=436">Leave a comment<span class="screen-reader-text"> on Using Google App Engine as Backend for Android</span></span></a></span>			</footer><!-- .entry-footer -->

</article><!-- #post-## -->

<article id="post-431" class="post-431 post type-post status-publish format-standard hentry category-sonstiges">
	
	<header class="entry-header">
		<h2 class="entry-title"><a href="http://www.marcusschiesser.de/2011/12/01/storing-large-images-restful-in-the-cloud-using-google-app-engine/" rel="bookmark">Storing large images RESTful in the cloud using Google App Engine</a></h2>	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>In my last article I showed <a href="http://www.marcusschiesser.de/2011/12/storing-files-restful-in-the-cloud-using-google-app-engine/">how to store files in the cloud using Google app engine</a>.<br />
Problem there was that the maximum size of the files was 1MB. Not that much for images.</p>
<p>To improve the situation, we just shrink the images with this very simple algorithm by factor 0.9 until the size is less than 1MB:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-57a019874d8d6009913807" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
public class FileTransformer {
	
	public static final Logger log = Logger.getLogger(FileTransformer.class.getName());

	private static final int JPEG_QUALITY = 90;
	private static final int MAX_FILE_SIZE = 1024*1024;

	public byte[] transform(byte[] ba, String mediaType) {
		if(mediaType.equalsIgnoreCase("image/jpeg")
				|| mediaType.equalsIgnoreCase("image/jpg")) {
			return imageTransform(ba);
		}
		throw new IllegalArgumentException("Unsupported media type: " + mediaType + " for this transformer");
	}

	private byte[] imageTransform(final byte[] ba) {
		byte[] result = ba;
		while(result.length&gt;MAX_FILE_SIZE) {
			final Image origImage = ImagesServiceFactory.makeImage(result);
			final Image newImage = shrinkImage(origImage, 0.9f);
			result = newImage.getImageData();
		}
		return result;
	}

	private Image shrinkImage(final Image origImage, final float percent) {
		final ImagesService imagesService = ImagesServiceFactory.getImagesService();
		log.fine("orig dimensions is " + origImage.getWidth() + " X " + origImage.getHeight());
		final OutputSettings settings = new OutputSettings(OutputEncoding.JPEG);
		settings.setQuality(JPEG_QUALITY);
		
		final Transform resize = ImagesServiceFactory.makeResize(Math.round(origImage.getWidth()*percent), Math.round(origImage.getHeight()*percent));
		final Image newImage = imagesService.applyTransform(resize, origImage, settings);
		return newImage;
	}

}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-2">2</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-4">4</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-6">6</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-8">8</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-10">10</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-12">12</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-14">14</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-16">16</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-18">18</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-20">20</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-22">22</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-24">24</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-26">26</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-28">28</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-30">30</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-32">32</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-34">34</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8d6009913807-36">36</div><div class="crayon-num" data-line="crayon-57a019874d8d6009913807-37">37</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-57a019874d8d6009913807-1"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">FileTransformer</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-2"><span class="crayon-h">	</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-3"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Logger </span><span class="crayon-v">log</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Logger</span><span class="crayon-sy">.</span><span class="crayon-e">getLogger</span><span class="crayon-sy">(</span><span class="crayon-v">FileTransformer</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">.</span><span class="crayon-e">getName</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-4">&nbsp;</div><div class="crayon-line" id="crayon-57a019874d8d6009913807-5"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">JPEG_QUALITY</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">90</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-6"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-h"> </span><span class="crayon-v">MAX_FILE_SIZE</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1024</span><span class="crayon-o">*</span><span class="crayon-cn">1024</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-8"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">ba</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">mediaType</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-9"><span class="crayon-h">		</span><span class="crayon-st">if</span><span class="crayon-sy">(</span><span class="crayon-v">mediaType</span><span class="crayon-sy">.</span><span class="crayon-e">equalsIgnoreCase</span><span class="crayon-sy">(</span><span class="crayon-s">"image/jpeg"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-10"><span class="crayon-h">				</span><span class="crayon-o">||</span><span class="crayon-h"> </span><span class="crayon-v">mediaType</span><span class="crayon-sy">.</span><span class="crayon-e">equalsIgnoreCase</span><span class="crayon-sy">(</span><span class="crayon-s">"image/jpg"</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-11"><span class="crayon-h">			</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">imageTransform</span><span class="crayon-sy">(</span><span class="crayon-v">ba</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-12"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-13"><span class="crayon-h">		</span><span class="crayon-st">throw</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">IllegalArgumentException</span><span class="crayon-sy">(</span><span class="crayon-s">"Unsupported media type: "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">mediaType</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">" for this transformer"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-14"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-16"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-e">imageTransform</span><span class="crayon-sy">(</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">ba</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-17"><span class="crayon-h">		</span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ba</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-18"><span class="crayon-h">		</span><span class="crayon-st">while</span><span class="crayon-sy">(</span><span class="crayon-v">result</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-o">&gt;</span><span class="crayon-v">MAX_FILE_SIZE</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-19"><span class="crayon-h">			</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Image </span><span class="crayon-v">origImage</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ImagesServiceFactory</span><span class="crayon-sy">.</span><span class="crayon-e">makeImage</span><span class="crayon-sy">(</span><span class="crayon-v">result</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-20"><span class="crayon-h">			</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Image </span><span class="crayon-v">newImage</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">shrinkImage</span><span class="crayon-sy">(</span><span class="crayon-v">origImage</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">0.9f</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-21"><span class="crayon-h">			</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">newImage</span><span class="crayon-sy">.</span><span class="crayon-e">getImageData</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-22"><span class="crayon-h">		</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-23"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-24"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-26"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">Image </span><span class="crayon-e">shrinkImage</span><span class="crayon-sy">(</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Image </span><span class="crayon-v">origImage</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">float</span><span class="crayon-h"> </span><span class="crayon-v">percent</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-27"><span class="crayon-h">		</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">ImagesService </span><span class="crayon-v">imagesService</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ImagesServiceFactory</span><span class="crayon-sy">.</span><span class="crayon-e">getImagesService</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-28"><span class="crayon-h">		</span><span class="crayon-v">log</span><span class="crayon-sy">.</span><span class="crayon-e">fine</span><span class="crayon-sy">(</span><span class="crayon-s">"orig dimensions is "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">origImage</span><span class="crayon-sy">.</span><span class="crayon-e">getWidth</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">" X "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">origImage</span><span class="crayon-sy">.</span><span class="crayon-e">getHeight</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-29"><span class="crayon-h">		</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">OutputSettings </span><span class="crayon-v">settings</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">OutputSettings</span><span class="crayon-sy">(</span><span class="crayon-v">OutputEncoding</span><span class="crayon-sy">.</span><span class="crayon-v">JPEG</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-30"><span class="crayon-h">		</span><span class="crayon-v">settings</span><span class="crayon-sy">.</span><span class="crayon-e">setQuality</span><span class="crayon-sy">(</span><span class="crayon-v">JPEG_QUALITY</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-31"><span class="crayon-h">		</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-32"><span class="crayon-h">		</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Transform </span><span class="crayon-v">resize</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ImagesServiceFactory</span><span class="crayon-sy">.</span><span class="crayon-e">makeResize</span><span class="crayon-sy">(</span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">origImage</span><span class="crayon-sy">.</span><span class="crayon-e">getWidth</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-v">percent</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">Math</span><span class="crayon-sy">.</span><span class="crayon-e">round</span><span class="crayon-sy">(</span><span class="crayon-v">origImage</span><span class="crayon-sy">.</span><span class="crayon-e">getHeight</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">*</span><span class="crayon-v">percent</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-33"><span class="crayon-h">		</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Image </span><span class="crayon-v">newImage</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">imagesService</span><span class="crayon-sy">.</span><span class="crayon-e">applyTransform</span><span class="crayon-sy">(</span><span class="crayon-v">resize</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">origImage</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">settings</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-34"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">newImage</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874d8d6009913807-35"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8d6009913807-36">&nbsp;</div><div class="crayon-line" id="crayon-57a019874d8d6009913807-37"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0072 seconds] -->
<p></p>
<p>This <code>FileTransformer</code> class is then just called in the <code>storeFile</code> method of the <code>FileServerResource</code> in the case the file size is large than 1MB:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-57a019874d8de847555814" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Java</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if (ba.length &gt; 1024 * 1024) {
    ba = new FileTransformer().transform(ba, mediaType);
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-57a019874d8de847555814-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874d8de847555814-2">2</div><div class="crayon-num" data-line="crayon-57a019874d8de847555814-3">3</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-57a019874d8de847555814-1"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">ba</span><span class="crayon-sy">.</span><span class="crayon-v">length</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">1024</span><span class="crayon-h"> </span><span class="crayon-o">*</span><span class="crayon-h"> </span><span class="crayon-cn">1024</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874d8de847555814-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">ba</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">FileTransformer</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">transform</span><span class="crayon-sy">(</span><span class="crayon-v">ba</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">mediaType</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874d8de847555814-3"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0008 seconds] -->
<p></p>
<p>Remark: So far this only works with JPEG media types, otherwise an exception is raised. Feel free to add different compression cases for other media types (e.g. using GZIP on texts). As I said, it is a good idea to store<br />
the media type 😉</p>
	</div><!-- .entry-content -->

	
	<footer class="entry-footer">
		<span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="http://www.marcusschiesser.de/2011/12/01/storing-large-images-restful-in-the-cloud-using-google-app-engine/" rel="bookmark"><time class="entry-date published updated" datetime="2011-12-01T18:27:36+00:00">December 1, 2011</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="http://www.marcusschiesser.de/category/sonstiges/" rel="category tag">Other</a></span><span class="comments-link"><a href="http://www.marcusschiesser.de/2011/12/01/storing-large-images-restful-in-the-cloud-using-google-app-engine/#respond"><span class="dsq-postid" data-dsqidentifier="431 http://www.marcusschiesser.de/?p=431">Leave a comment<span class="screen-reader-text"> on Storing large images RESTful in the cloud using Google App Engine</span></span></a></span>			</footer><!-- .entry-footer -->

</article><!-- #post-## -->

<article id="post-420" class="post-420 post type-post status-publish format-standard hentry category-java">
	
	<header class="entry-header">
		<h2 class="entry-title"><a href="http://www.marcusschiesser.de/2011/12/01/storing-files-restful-in-the-cloud-using-google-app-engine/" rel="bookmark">Storing files RESTful in the cloud using Google App Engine</a></h2>	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>Do you want to store files RESTful in the cloud? Why not use the Google App Engine for it?</p>
<p>Firstly you will need a entity class that is storing the file in the data store:</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-57a019874dc54983957360" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
@Entity
public class FileEntity {
	@Id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long key;
	
	private Blob content;
	private String mediaType;

	public Long getKey() {
		return key;
	}

	public Blob getContent() {
		return content;
	}

	public void setContent(Blob content) {
		this.content = content;
	}

	public String getMediaType() {
		return mediaType;
	}

	public void setMediaType(String mediaType) {
		this.mediaType = mediaType;
	}	
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-57a019874dc54983957360-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-2">2</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-4">4</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-6">6</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-8">8</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-10">10</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-12">12</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-14">14</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-16">16</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-18">18</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-20">20</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-22">22</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-24">24</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-26">26</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc54983957360-28">28</div><div class="crayon-num" data-line="crayon-57a019874dc54983957360-29">29</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-57a019874dc54983957360-1"><span class="crayon-sy">@</span><span class="crayon-e">Entity</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-2"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">FileEntity</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-3"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-i">Id</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-4"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">GeneratedValue</span><span class="crayon-sy">(</span><span class="crayon-v">strategy</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">GenerationType</span><span class="crayon-sy">.</span><span class="crayon-v">IDENTITY</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-5"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">Long</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-6"><span class="crayon-h">	</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-7"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">Blob </span><span class="crayon-v">content</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-8"><span class="crayon-h">	</span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">mediaType</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-10"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">Long</span><span class="crayon-h"> </span><span class="crayon-e">getKey</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-11"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">key</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-12"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-14"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Blob </span><span class="crayon-e">getContent</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-15"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">content</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-16"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-18"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setContent</span><span class="crayon-sy">(</span><span class="crayon-e">Blob </span><span class="crayon-v">content</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-19"><span class="crayon-h">		</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">content</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">content</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-20"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-21">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-22"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-e">getMediaType</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-23"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">mediaType</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-24"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-26"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">setMediaType</span><span class="crayon-sy">(</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">mediaType</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-27"><span class="crayon-h">		</span><span class="crayon-r">this</span><span class="crayon-sy">.</span><span class="crayon-v">mediaType</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">mediaType</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc54983957360-28"><span class="crayon-h">	</span><span class="crayon-sy">}</span><span class="crayon-h">	</span></div><div class="crayon-line" id="crayon-57a019874dc54983957360-29"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0728 seconds] -->
<p>Beside the actual content of the file, this entity also stores the media type (you never know, it might be good to know&#8230;).<br />
As I just like standards, you also might mention that I used JPA as much as possible (<code>Blob</code> is a Google specific thing, as unfortunately <code>byte[]</code> can not store large amounts. BTW: <code>Blob</code> is also limited by 1MB, so you can not store larger files than 1MB using this approach).</p>
<p>Secondly you will need a JAX-RS resource class that is handling the GET and PUT requests from clients:</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-57a019874dc5b779216596" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
@Path("/file")
public class FileServerResource {

	public static final Logger log = Logger.getLogger(FileServerResource.class.getName());

	@Context
	UriInfo uriInfo;
	@Context
	HttpHeaders headers;
	@Context
	HttpServletResponse response;

	@PUT
	@Path("/store")
	@Consumes({ MediaType.TEXT_PLAIN, "image/jpeg", "image/png", "image/gif", "application/zip" })
	@Produces({ MediaType.TEXT_PLAIN })
	public String storeFile(final byte[] b) {
		FileEntity file = EMF.doTransaction(new EMF.Closure&lt;FileEntity&gt;() {
			public FileEntity doit(EntityManager em) {
				byte[] ba = b;
				String mediaType = headers.getMediaType().toString();
				FileEntity file = new FileEntity();
				file.setContent(new Blob(ba));
				file.setMediaType(mediaType);
				em.persist(file);
				return file;
			}
		});
		UriBuilder ub = uriInfo.getBaseUriBuilder();
		URI link = ub.path("/file/get/" + file.getKey().toString()).build();
		return link.toString();
	}

	@GET
	@Path("/get/{id}")
	@Produces("*/*")
	public Response getFile(@PathParam("id") final long id) {
		return EMF.doTransaction(new EMF.Closure&lt;Response&gt;() {
			public Response doit(EntityManager em) {
				FileEntity entity = em.find(FileEntity.class, id);
				if (entity == null)
					throw new WebApplicationException(404);
				return Response.ok(entity.getContent().getBytes(), entity.getMediaType()).build();
			}
		});
	}
}</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-2">2</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-4">4</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-6">6</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-8">8</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-10">10</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-12">12</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-14">14</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-16">16</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-18">18</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-20">20</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-22">22</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-24">24</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-26">26</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-28">28</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-30">30</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-32">32</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-34">34</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-36">36</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-38">38</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-40">40</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-42">42</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-44">44</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874dc5b779216596-46">46</div><div class="crayon-num" data-line="crayon-57a019874dc5b779216596-47">47</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-57a019874dc5b779216596-1"><span class="crayon-sy">@</span><span class="crayon-e">Path</span><span class="crayon-sy">(</span><span class="crayon-s">"/file"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-2"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">FileServerResource</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-4"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-e">Logger </span><span class="crayon-v">log</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Logger</span><span class="crayon-sy">.</span><span class="crayon-e">getLogger</span><span class="crayon-sy">(</span><span class="crayon-v">FileServerResource</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">.</span><span class="crayon-e">getName</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-5">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-6"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Context</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-7"><span class="crayon-e">	</span><span class="crayon-e">UriInfo </span><span class="crayon-v">uriInfo</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-8"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Context</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-9"><span class="crayon-e">	</span><span class="crayon-e">HttpHeaders </span><span class="crayon-v">headers</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-10"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Context</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-11"><span class="crayon-e">	</span><span class="crayon-e">HttpServletResponse </span><span class="crayon-v">response</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-12">&nbsp;</div><div class="crayon-line" id="crayon-57a019874dc5b779216596-13"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-i">PUT</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-14"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Path</span><span class="crayon-sy">(</span><span class="crayon-s">"/store"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-15"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Consumes</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">MediaType</span><span class="crayon-sy">.</span><span class="crayon-v">TEXT_PLAIN</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"image/jpeg"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"image/png"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"image/gif"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"application/zip"</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-16"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Produces</span><span class="crayon-sy">(</span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-v">MediaType</span><span class="crayon-sy">.</span><span class="crayon-v">TEXT</span><span class="crayon-sy">_</span>PLAIN<span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-17"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-e">storeFile</span><span class="crayon-sy">(</span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-18"><span class="crayon-h">		</span><span class="crayon-e">FileEntity </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">EMF</span><span class="crayon-sy">.</span><span class="crayon-e">doTransaction</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">EMF</span><span class="crayon-sy">.</span><span class="crayon-v">Closure</span><span class="crayon-o">&lt;</span><span class="crayon-v">FileEntity</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-19"><span class="crayon-h">			</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">FileEntity </span><span class="crayon-e">doit</span><span class="crayon-sy">(</span><span class="crayon-e">EntityManager </span><span class="crayon-v">em</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-20"><span class="crayon-h">				</span><span class="crayon-t">byte</span><span class="crayon-sy">[</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-v">ba</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">b</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-21"><span class="crayon-h">				</span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">mediaType</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">headers</span><span class="crayon-sy">.</span><span class="crayon-e">getMediaType</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">toString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-22"><span class="crayon-h">				</span><span class="crayon-e">FileEntity </span><span class="crayon-v">file</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">FileEntity</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-23"><span class="crayon-h">				</span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">setContent</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Blob</span><span class="crayon-sy">(</span><span class="crayon-v">ba</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-24"><span class="crayon-h">				</span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">setMediaType</span><span class="crayon-sy">(</span><span class="crayon-v">mediaType</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-25"><span class="crayon-h">				</span><span class="crayon-v">em</span><span class="crayon-sy">.</span><span class="crayon-e">persist</span><span class="crayon-sy">(</span><span class="crayon-v">file</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-26"><span class="crayon-h">				</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-27"><span class="crayon-h">			</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-28"><span class="crayon-h">		</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-29"><span class="crayon-h">		</span><span class="crayon-e">UriBuilder </span><span class="crayon-v">ub</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">uriInfo</span><span class="crayon-sy">.</span><span class="crayon-e">getBaseUriBuilder</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-30"><span class="crayon-h">		</span><span class="crayon-e">URI </span><span class="crayon-v">link</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">ub</span><span class="crayon-sy">.</span><span class="crayon-e">path</span><span class="crayon-sy">(</span><span class="crayon-s">"/file/get/"</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-v">file</span><span class="crayon-sy">.</span><span class="crayon-e">getKey</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">toString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-31"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">link</span><span class="crayon-sy">.</span><span class="crayon-e">toString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-32"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-34"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-i">GET</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-35"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Path</span><span class="crayon-sy">(</span><span class="crayon-s">"/get/{id}"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-36"><span class="crayon-h">	</span><span class="crayon-sy">@</span><span class="crayon-e">Produces</span><span class="crayon-sy">(</span><span class="crayon-s">"*/*"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-37"><span class="crayon-h">	</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Response </span><span class="crayon-e">getFile</span><span class="crayon-sy">(</span><span class="crayon-sy">@</span><span class="crayon-e">PathParam</span><span class="crayon-sy">(</span><span class="crayon-s">"id"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">long</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-38"><span class="crayon-h">		</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">EMF</span><span class="crayon-sy">.</span><span class="crayon-e">doTransaction</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-v">EMF</span><span class="crayon-sy">.</span><span class="crayon-v">Closure</span><span class="crayon-o">&lt;</span><span class="crayon-v">Response</span><span class="crayon-o">&gt;</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-39"><span class="crayon-h">			</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">Response </span><span class="crayon-e">doit</span><span class="crayon-sy">(</span><span class="crayon-e">EntityManager </span><span class="crayon-v">em</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-40"><span class="crayon-h">				</span><span class="crayon-e">FileEntity </span><span class="crayon-v">entity</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">em</span><span class="crayon-sy">.</span><span class="crayon-e">find</span><span class="crayon-sy">(</span><span class="crayon-v">FileEntity</span><span class="crayon-sy">.</span><span class="crayon-t">class</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">id</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-41"><span class="crayon-h">				</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">entity</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-t">null</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-42"><span class="crayon-h">					</span><span class="crayon-st">throw</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">WebApplicationException</span><span class="crayon-sy">(</span><span class="crayon-cn">404</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-43"><span class="crayon-h">				</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">Response</span><span class="crayon-sy">.</span><span class="crayon-e">ok</span><span class="crayon-sy">(</span><span class="crayon-v">entity</span><span class="crayon-sy">.</span><span class="crayon-e">getContent</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">getBytes</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">entity</span><span class="crayon-sy">.</span><span class="crayon-e">getMediaType</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">build</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-44"><span class="crayon-h">			</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-45"><span class="crayon-h">		</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874dc5b779216596-46"><span class="crayon-h">	</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-57a019874dc5b779216596-47"><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0078 seconds] -->
<p></p>
<p>At last you just need a small helper class (<a href='http://www.marcusschiesser.de/wp-content/uploads/2011/12/EMF.java' >EMF.java</a>) that is handling the transactions and of course an JAX-RS implementation (I used <a href="http://jersey.java.net/">Jersey 1.6</a> &#8211; works perfectly with App Engine).</p>
<p>To test the file store, just call:<br />
<code>curl --upload-file mypic.jpg -H "Content-Type: image/jpeg" http://localhost:8888/rest/file/store</code></p>
<p>This request returns the URL of the file that is stored. Just request this URL to retrieve your file back from the storage.</p>
<p>Have fun and let me know, if you are using this code for some of your projects.</p>
	</div><!-- .entry-content -->

	
	<footer class="entry-footer">
		<span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="http://www.marcusschiesser.de/2011/12/01/storing-files-restful-in-the-cloud-using-google-app-engine/" rel="bookmark"><time class="entry-date published updated" datetime="2011-12-01T18:09:27+00:00">December 1, 2011</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="http://www.marcusschiesser.de/category/technologie/java/" rel="category tag">Java</a></span><span class="comments-link"><a href="http://www.marcusschiesser.de/2011/12/01/storing-files-restful-in-the-cloud-using-google-app-engine/#respond"><span class="dsq-postid" data-dsqidentifier="420 http://www.marcusschiesser.de/?p=420">Leave a comment<span class="screen-reader-text"> on Storing files RESTful in the cloud using Google App Engine</span></span></a></span>			</footer><!-- .entry-footer -->

</article><!-- #post-## -->

<article id="post-413" class="post-413 post type-post status-publish format-standard hentry category-java tag-annotations tag-java tag-jax-rs tag-jaxb tag-jersey tag-json tag-marshall tag-pojo tag-rest tag-serialize">
	
	<header class="entry-header">
		<h2 class="entry-title"><a href="http://www.marcusschiesser.de/2011/12/01/using-real-pojos-without-jaxb-annotations-as-transfer-objects-with-jax-rs/" rel="bookmark">Using real POJOs (without JAXB Annotations) as transfer objects with JAX-RS</a></h2>	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>Are you annoyed that you have to annotate your POJOs with <code>@XmlRootElement</code>, so they can be used with JAX-RS? If your using Jersey as JAX-RS implementation your lucky: Just add to the <code>&lt;servlet&gt;</code> tag in your <code>web.xml</code> the following snippet:</p>
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-57a019874e05d290587595" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">XHTML</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;init-param&gt;
	&lt;param-name&gt;com.sun.jersey.api.json.POJOMappingFeature&lt;/param-name&gt;
	&lt;param-value&gt;true&lt;/param-value&gt;
&lt;/init-param&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums" data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-57a019874e05d290587595-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874e05d290587595-2">2</div><div class="crayon-num" data-line="crayon-57a019874e05d290587595-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-57a019874e05d290587595-4">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-57a019874e05d290587595-1"><span class="crayon-r">&lt;init-param&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874e05d290587595-2"><span class="crayon-i">	</span><span class="crayon-r">&lt;param-name&gt;</span><span class="crayon-i">com.sun.jersey.api.json.POJOMappingFeature</span><span class="crayon-r">&lt;/param-name&gt;</span></div><div class="crayon-line" id="crayon-57a019874e05d290587595-3"><span class="crayon-i">	</span><span class="crayon-r">&lt;param-value&gt;</span><span class="crayon-i">true</span><span class="crayon-r">&lt;/param-value&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-57a019874e05d290587595-4"><span class="crayon-r">&lt;/init-param&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p></p>
<p>After restarting your servlet, your POJOs are marshalled to JSON as a charme. Enjoy!</p>
	</div><!-- .entry-content -->

	
	<footer class="entry-footer">
		<span class="posted-on"><span class="screen-reader-text">Posted on </span><a href="http://www.marcusschiesser.de/2011/12/01/using-real-pojos-without-jaxb-annotations-as-transfer-objects-with-jax-rs/" rel="bookmark"><time class="entry-date published updated" datetime="2011-12-01T17:06:30+00:00">December 1, 2011</time></a></span><span class="cat-links"><span class="screen-reader-text">Categories </span><a href="http://www.marcusschiesser.de/category/technologie/java/" rel="category tag">Java</a></span><span class="tags-links"><span class="screen-reader-text">Tags </span><a href="http://www.marcusschiesser.de/tag/annotations/" rel="tag">annotations</a>, <a href="http://www.marcusschiesser.de/tag/java/" rel="tag">Java</a>, <a href="http://www.marcusschiesser.de/tag/jax-rs/" rel="tag">jax-rs</a>, <a href="http://www.marcusschiesser.de/tag/jaxb/" rel="tag">jaxb</a>, <a href="http://www.marcusschiesser.de/tag/jersey/" rel="tag">jersey</a>, <a href="http://www.marcusschiesser.de/tag/json/" rel="tag">json</a>, <a href="http://www.marcusschiesser.de/tag/marshall/" rel="tag">marshall</a>, <a href="http://www.marcusschiesser.de/tag/pojo/" rel="tag">pojo</a>, <a href="http://www.marcusschiesser.de/tag/rest/" rel="tag">rest</a>, <a href="http://www.marcusschiesser.de/tag/serialize/" rel="tag">serialize</a></span><span class="comments-link"><a href="http://www.marcusschiesser.de/2011/12/01/using-real-pojos-without-jaxb-annotations-as-transfer-objects-with-jax-rs/#respond"><span class="dsq-postid" data-dsqidentifier="413 http://www.marcusschiesser.de/?p=413">Leave a comment<span class="screen-reader-text"> on Using real POJOs (without JAXB Annotations) as transfer objects with JAX-RS</span></span></a></span>			</footer><!-- .entry-footer -->

</article><!-- #post-## -->

	<nav class="navigation pagination" role="navigation">
		<h2 class="screen-reader-text">Posts navigation</h2>
		<div class="nav-links"><a class="prev page-numbers" href="http://www.marcusschiesser.de/page/2/">Previous page</a>
<a class='page-numbers' href='http://www.marcusschiesser.de/'><span class="meta-nav screen-reader-text">Page </span>1</a>
<a class='page-numbers' href='http://www.marcusschiesser.de/page/2/'><span class="meta-nav screen-reader-text">Page </span>2</a>
<span class='page-numbers current'><span class="meta-nav screen-reader-text">Page </span>3</span>
<a class='page-numbers' href='http://www.marcusschiesser.de/page/4/'><span class="meta-nav screen-reader-text">Page </span>4</a>
<span class="page-numbers dots">&hellip;</span>
<a class='page-numbers' href='http://www.marcusschiesser.de/page/16/'><span class="meta-nav screen-reader-text">Page </span>16</a>
<a class="next page-numbers" href="http://www.marcusschiesser.de/page/4/">Next page</a></div>
	</nav>
		</main><!-- .site-main -->
	</div><!-- .content-area -->


	</div><!-- .site-content -->

	<footer id="colophon" class="site-footer" role="contentinfo">
		<div class="site-info">
						<a href="https://wordpress.org/">Proudly powered by WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- .site-footer -->

</div><!-- .site -->

<script type='text/javascript' src='http://www.marcusschiesser.de/wp-content/themes/twentyfifteen/js/skip-link-focus-fix.js?ver=20141010'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var screenReaderText = {"expand":"<span class=\"screen-reader-text\">expand child menu<\/span>","collapse":"<span class=\"screen-reader-text\">collapse child menu<\/span>"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.marcusschiesser.de/wp-content/themes/twentyfifteen/js/functions.js?ver=20150330'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var countVars = {"disqusShortname":"marcusschiesser"};
/* ]]> */
</script>
<script type='text/javascript' src='http://www.marcusschiesser.de/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.3.1'></script>

</body>
</html>
